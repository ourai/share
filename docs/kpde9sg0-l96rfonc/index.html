<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>机器人工厂重构第二期</title> <meta property="og:title" content="机器人工厂重构第二期"> <meta name="description" content="项目安排"> <meta property="og:description" content="项目安排"> <link rel="canonical" href="https://ourai.ws/docs/kpde9sg0-l96rfonc/"> <meta property="og:url" content="https://ourai.ws/docs/kpde9sg0-l96rfonc/"> <meta property="og:site_name" content="欧雷共享的内容"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "欧雷共享的内容", "url" : "https://ourai.ws" } </script> <meta property="og:type" content="article"> <meta property="article:published_time" content="2021-06-01T10:01:12+08:00"> <link rel="next" href="https://ourai.ws/docs/kruel7yw-l86n1pun/" title="Handie"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "机器人工厂重构第二期", "image": null, "datePublished": "2021-06-01T10:01:12+08:00", "description": "项目安排" } </script> <link rel="author" href="https://ourai.ws"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <!-- 订阅 --> <link type="application/atom+xml" rel="alternate" href="https://ourai.ws/atom.xml" title="欧雷流" /> <meta name="theme-color" content="#0871ab"> <link type="application/rss+xml" rel="alternate" href="//share.ourai.ws/rss.xml" title="欧雷共享的内容"> <!-- 站点 icon --> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/disqusjs.min-b077139304675330d06888b873bd88158951637593a3c17c4674bc855caf71af.css"> <link type="text/css" rel="stylesheet" href="/assets/global-cf407110a040e90d8729159566aed4aaf5b58023447f098d688501887e91f510.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-d5f1244d69bfc31e3c7b73b16140ed8a09f0b5af40515abeae522bee80e92ec9.css"> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page" itemscope itemtype="http://schema.org/WebPage"> <main class="Page-content"> <div id="sharedDoc" class="container"> <p style="height: 100%; display: flex; align-items: center; justify-content: center; font-size: 8rem;">🙅🏻‍♂️</p> </div> </main> <ourai-doc id="__ourai_doc__" style="display: none;" data-code="3aap"> <article class="Page-main Article"> <header class="Article-header"> <h1 class="Article-title">机器人工厂重构第二期</h1> <p><a href="https://ourai.ws/people/ourai/" target="_blank" ref="external nofollow">欧雷</a> 发表于 <time datetime="2021-06-01T10:01:12+08:00">2021-06-01 10:01:12</time></p> </header> <div class="Article-content col-md-9"><h2 id="section">项目安排</h2> <h3 id="section-1">概览</h3> <table> <thead> <tr> <th>项目</th> <th>内容</th> </tr> </thead> <tbody> <tr> <td>时间</td> <td>2021 年 6 月 1 日</td> </tr> <tr> <td>优先级</td> <td>低</td> </tr> <tr> <td>人员</td> <td>前端：<a href="https://yaol.in/" title="查看林垚的个人主页" target="_blank" rel="external nofollow">林垚</a></td> </tr> </tbody> </table> <h3 id="section-2">任务</h3> <p>将机器人工厂中需要配置化的页面及进度进行整理。</p> <h4 id="section-3">列表类</h4> <table> <thead> <tr> <th>一级菜单</th> <th>二级/三级菜单</th> <th>模块</th> <th>视图</th> <th>改造难度</th> <th>进度</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td>语料库</td> <td>首页</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td> </td> <td>业务问题库/业务用户问题库管理</td> <td><code>high-frequency-question </code></td> <td><code>high-frequency-question-list </code></td> <td> </td> <td>完成</td> <td> </td> </tr> <tr> <td> </td> <td>业务问题库/语料分析/查看分析结果</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td> </td> <td>业务问题库/智能标注</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td> </td> <td>业务问题库/无匹配用户问题聚类</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td> </td> <td>业务问题库/语料粒度管理/单条操作</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td> </td> <td>业务问题库/语料粒度管理/语料密度</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>知识库</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>运维</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>资源</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>测试</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> <tr> <td>更多</td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> </tr> </tbody> </table> <h2 id="section-4">需求分析</h2> <p>将《机器人工厂重构第一期》中未完成的部分与新发现的问题解决。</p> <h3 id="section-5">提高模块内聚性</h3> <p>通过调整目录结构和模块系统来提高内聚性。</p> <h4 id="section-6">目录结构调整</h4> <p>基于现在的目录结构调整后的结果大体如下：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>project/src
   ├── domain
   │   └── [domain-specific-module]
   │       ├── views
   │       │   ├── [detail-view]
   │       │   │   ├── [DetailViewComponent].vue
   │       │   │   ├── ...
   │       │   │   └── style.scss
   │       │   ├── [form-view]
   │       │   │   ├── [FormViewComponent].vue
   │       │   │   ├── ...
   │       │   │   └── style.scss
   │       │   └── [list-view]
   │       │       ├── [ListViewComponent].vue
   │       │       ├── ...
   │       │       └── style.scss
   │       ├── widgets
   │       │   └── [domain-specific-widget]
   │       │       └── ...
   │       ├── helper.ts
   │       ├── index.ts
   │       ├── model.ts
   │       ├── repository.ts
   │       └── ...
   ├── entry
   │   ├── aspects
   │   │   ├── http.ts
   │   │   ├── router.ts
   │   │   ├── ...
   │   │   └── index.ts
   │   ├── layouts
   │   │   └── ...
   │   └── router
   │       └── ...
   ├── shared
   │   └── ...
   ├── App.vue
   └── main.ts</code></pre></figure> <p>调整后的 <code>domain</code> 文件夹的含义不再是「领域层」，而是「领域/业务模块组」。</p> <p>调整前后模块间依赖对比：</p> <p><img src="/assets/docs/kpde9sg0-l96rfonc/layered-vs-modularized-6b6c6dd747167a62446c90eb37e9927200ff1c68a52106238bb3065430b530b8.png" alt="" /></p> <h4 id="section-7">模块注册与查找机制</h4> <p>运行时的模块系统，也可以优化为编译时。</p> <p>模块描述：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;module-name&#39;</span><span class="p">,</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;[module-name].[resource-type].[resource-name]&#39;</span><span class="p">],</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;[resource-type]&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;[resource-name]&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure> <p>该描述信息用于模块内查找获取依赖以及在应用入口处统一注册模块。</p> <p>标识含义：</p> <ul> <li><code>[module-name]</code> 是模块名；</li> <li><code>[resource-type]</code> 是资源类型，目前包括 <code>services</code>（请求服务）、<code>utils</code>（工具函数）和 <code>widgets</code>（部件/业务组件）；</li> <li><code>[resource-name]</code> 是资源名称。</li> </ul> <p>缺陷：</p> <ul> <li>一定程度上破坏了类型推导，可能需要编写 VS Code 插件解决。</li> </ul> <h3 id="section-8">路由配置调整</h3> <p>定义并扩展 Vue Router 的路由元信息（<code>meta</code> 属性）：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kr">type</span> <span class="nx">RouteMeta</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">text?</span>: <span class="kt">string</span><span class="p">;</span>          <span class="c1">// 菜单文本和页面标题</span>
  <span class="nx">icon?</span>: <span class="kt">string</span><span class="p">;</span>          <span class="c1">// 菜单图标</span>
  <span class="nx">show?</span>: <span class="kt">boolean</span><span class="p">;</span>         <span class="c1">// 是否在菜单中显示，默认为 `true`</span>
  <span class="nx">auth?</span>: <span class="kt">string</span><span class="p">[];</span>        <span class="c1">// 访问权限标识</span>
  <span class="nx">buildFor</span><span class="o">?:</span> <span class="s1">&#39;G&#39;</span> <span class="o">|</span> <span class="s1">&#39;B&#39;</span><span class="p">;</span>   <span class="c1">// B 端或 G 端，不标明则在两端都有</span>
<span class="p">};</span></code></pre></figure> <h4 id="section-9">菜单根据路由配置生成</h4> <p>根据路由配置的顺序和层级以及路由元信息生成导航菜单（包括顶部和侧边栏）。</p> <h4 id="section-10">访问权限控制调整</h4> <p>将在路由跳转时控制改为在布局中渲染时控制，无权限访问不是跳转到无权限页面而是在当前页面渲染无权限组件。</p> <h3 id="section-11">组件动态引用</h3> <p>部件/业务组件、视图和页面中所依赖的组件从通过 <code>import</code> 的静态引用改为通过上下文获取的动态引用。通过该方式引用基础组件和其他模块定义的部件/业务组件。</p> <p>某个模块内要用到的组件需要通过模块描述进行声明：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;animation&#39;</span><span class="p">,</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="s1">&#39;common.widgets.TableView&#39;</span>
  <span class="p">],</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">ElButton</span>: <span class="kt">true</span><span class="p">,</span> <span class="c1">// 基础组件</span>
    <span class="nx">TableView</span><span class="o">:</span> <span class="s1">&#39;common.widgets.TableView&#39;</span> <span class="c1">// 对其他模块中定义的部件/业务组件需要先引入（上面的 `imports`）再引用</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure> <p>获取组件引用：</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TestWidget&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">el-button</span><span class="p">&gt;</span>基础组件里的按钮<span class="p">&lt;/</span><span class="nt">el-button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table-view</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ts&quot;</span><span class="p">&gt;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">context</span> <span class="kr">from</span> <span class="s1">&#39;../../context&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getComponents</span><span class="p">(),</span>
<span class="p">})</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">TestWidget</span> <span class="k">extends</span> <span class="nx">Vue</span> <span class="p">{}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></figure> <h3 id="crud-">CRUD 相关页面配置化</h3> <p>将模式化的 CRUD 相关页面通过配置动态生成。</p> <h4 id="section-12">区分「页面」与「视图」</h4> <p>更为严格区分「页面」与「视图」——「页面」是与 URL 相对应的，可以认为一个 URL 就是一个「页面」；「视图」是数据集合（列表或对象）的呈现，一个页面包含一个及以上数量的视图。</p> <p>「视图」常见的呈现形式有表格、表单（读、写状态）、其他类型的列表。</p> <p>在重构和接新需求时基本要以某块片段是不是一个列表或表单来拆分出视图。例如：有的页面会有多个选项卡或列表模式切换器去切换列表的展示，每个/种列表就是一个视图。</p> <h4 id="section-13">视图配置化</h4> <p>除了常规的开发方式之外，提供一种通过配置动态生成视图的方式。</p> <p>表格视图：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">createTableView</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@/utils/view&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="kr">module</span><span class="nx">Context</span> <span class="kr">from</span> <span class="s1">&#39;../../context&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">Search</span> <span class="kr">from</span> <span class="s1">&#39;./Search.vue&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">TitleField</span> <span class="kr">from</span> <span class="s1">&#39;./TitleField.vue&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">EpisodesField</span> <span class="kr">from</span> <span class="s1">&#39;./EpisodesField.vue&#39;</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">createTableView</span><span class="p">(</span><span class="kr">module</span><span class="nx">Context</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">fields</span><span class="o">:</span> <span class="p">[</span> <span class="c1">// 要展示的表格数据列</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;标题&#39;</span><span class="p">,</span> <span class="nx">render</span>: <span class="kt">TitleField</span><span class="p">,</span> <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;300&#39;</span> <span class="p">}</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;简介&#39;</span> <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;episodes&#39;</span><span class="p">,</span>
      <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;集数&#39;</span><span class="p">,</span>
      <span class="nx">render</span>: <span class="kt">EpisodesField</span><span class="p">,</span>
      <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;60&#39;</span><span class="p">,</span> <span class="nx">align</span><span class="o">:</span> <span class="s1">&#39;center&#39;</span> <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">],</span>
  <span class="nx">actions</span><span class="o">:</span> <span class="p">[</span> <span class="c1">// 视图拥有的操作按钮，有的会显示在表格外部，有的会显示在操作列中，可以进行权限控制</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;gotoCreateFormView&#39;</span><span class="p">,</span> <span class="nx">authority</span><span class="o">:</span> <span class="s1">&#39;animation:edit&#39;</span><span class="p">,</span> <span class="nx">primary</span>: <span class="kt">true</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;deleteList&#39;</span><span class="p">,</span> <span class="nx">authority</span><span class="o">:</span> <span class="s1">&#39;animation:edit&#39;</span> <span class="p">},</span>
    <span class="s1">&#39;gotoDetailView&#39;</span><span class="p">,</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;gotoEditFormView&#39;</span><span class="p">,</span> <span class="nx">authority</span><span class="o">:</span> <span class="s1">&#39;animation:edit&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;deleteOne&#39;</span><span class="p">,</span> <span class="nx">authority</span><span class="o">:</span> <span class="s1">&#39;animation:edit&#39;</span> <span class="p">},</span>
  <span class="p">],</span>
  <span class="nx">search</span>: <span class="kt">Search</span><span class="p">,</span> <span class="c1">// 视图的搜索部分</span>
  <span class="nx">config</span><span class="o">:</span> <span class="p">{</span> <span class="nx">checkable</span>: <span class="kt">true</span><span class="p">,</span> <span class="nx">operationColumnWidth</span>: <span class="kt">250</span> <span class="p">},</span> <span class="c1">// 视图显示上的一些配置</span>
  <span class="nx">getList</span><span class="o">:</span> <span class="s1">&#39;getAnimationList&#39;</span><span class="p">,</span>
  <span class="nx">deleteOne</span><span class="o">:</span> <span class="s1">&#39;deleteAnimationBy&#39;</span><span class="p">,</span>
  <span class="nx">deleteList</span><span class="o">:</span> <span class="s1">&#39;deleteAnimationListBy&#39;</span><span class="p">,</span>
<span class="p">});</span></code></pre></figure> <p>详情视图：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="k">import</span> <span class="p">{</span> <span class="nx">createDetailView</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@/utils/view&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="kr">module</span><span class="nx">Context</span> <span class="kr">from</span> <span class="s1">&#39;../../context&#39;</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">createDetailView</span><span class="p">(</span><span class="kr">module</span><span class="nx">Context</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">fields</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;标题&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;简介&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;episodes&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;剧集&#39;</span> <span class="p">},</span>
  <span class="p">],</span>
  <span class="nx">getOne</span><span class="o">:</span> <span class="s1">&#39;getAnimationById&#39;</span><span class="p">,</span>
<span class="p">});</span></code></pre></figure> <p>字段描述器：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kr">type</span> <span class="nx">FieldDescriptor</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 用于取值的 key</span>
  <span class="nx">label?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 用于显示的文本</span>
  <span class="nx">required?</span>: <span class="kt">boolean</span><span class="p">;</span> <span class="c1">// 是否必需</span>
  <span class="nx">render?</span>: <span class="kt">string</span> <span class="o">|</span> <span class="nx">VueConstructor</span> <span class="o">|</span> <span class="nx">CellRenderer</span><span class="o">&lt;</span><span class="nx">TableColumn</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// 要渲染的组件</span>
  <span class="nx">config?</span>: <span class="kt">FieldConfig</span><span class="p">;</span> <span class="c1">// 用于表格列或表单字段组件的配置</span>
<span class="p">};</span></code></pre></figure> <p>动作描述器：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kr">type</span> <span class="nx">ActionDescriptor</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 用于查找已注册动作的唯一标识</span>
  <span class="nx">context</span><span class="o">?:</span> <span class="s1">&#39;free&#39;</span> <span class="o">|</span> <span class="s1">&#39;single&#39;</span> <span class="o">|</span> <span class="s1">&#39;batch&#39;</span> <span class="o">|</span> <span class="s1">&#39;both&#39;</span><span class="p">;</span> <span class="c1">// 影响动作显示位置和执行的上下文类型</span>
  <span class="nx">authority?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 操作权限控制标识</span>
  <span class="nx">text?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 用于显示的文本</span>
  <span class="nx">primary?</span>: <span class="kt">boolean</span><span class="p">;</span> <span class="c1">// 是否为主要操作</span>
  <span class="nx">danger?</span>: <span class="kt">boolean</span><span class="p">;</span> <span class="c1">// 是否为危险操作，会进行二次确认，可通过 `confirm` 自定义提示文本</span>
  <span class="nx">confirm?</span>: <span class="kt">boolean</span> <span class="o">|</span> <span class="kt">string</span><span class="p">;</span> <span class="c1">// 是否需要二次确认及提示文本</span>
  <span class="nx">render</span><span class="o">?:</span> <span class="s1">&#39;button&#39;</span> <span class="o">|</span> <span class="s1">&#39;link&#39;</span> <span class="o">|</span> <span class="nx">VueConstructor</span><span class="p">;</span> <span class="c1">// 要渲染的组件</span>
  <span class="nx">config?</span>: <span class="kt">ActionConfig</span><span class="p">;</span> <span class="c1">// 用于要渲染的组件的配置</span>
  <span class="nx">execute</span><span class="o">?:</span> <span class="o">&lt;</span><span class="nx">ViewContext</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">viewContext</span>: <span class="kt">ViewContext</span><span class="p">,</span> <span class="nx">vm</span>: <span class="kt">Vue</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span> <span class="o">|</span> <span class="nx">any</span><span class="p">;</span> <span class="c1">// 要执行的逻辑</span>
<span class="p">};</span></code></pre></figure> <p>基础的视图描述器：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kr">type</span> <span class="nx">ViewDescriptor</span><span class="o">&lt;</span><span class="nx">ConfigType</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">search?</span>: <span class="kt">SearchDescriptor</span> <span class="o">|</span> <span class="nx">VueConstructor</span><span class="p">;</span> <span class="c1">// 要渲染的搜索</span>
  <span class="nx">fields</span>: <span class="kt">FieldDescriptor</span><span class="p">[];</span> <span class="c1">// 数据列或表单字段的描述</span>
  <span class="nx">actions</span><span class="o">?:</span> <span class="p">(</span><span class="nx">ActionDescriptor</span> <span class="o">|</span> <span class="kt">string</span><span class="p">)[];</span> <span class="c1">// 拥有的操作按钮</span>
  <span class="nx">actionsAuthority?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 集中控制操作按钮的权限，不指定则每个操作按钮分控，总控和分控只能选其一</span>
  <span class="nx">config?</span>: <span class="kt">ConfigType</span><span class="p">;</span> <span class="c1">// 视图显示上的一些配置</span>
<span class="p">};</span></code></pre></figure> <h2 id="section-14">设计</h2> <h3 id="section-15">问答库表单/详情页</h3> <p>问答库的表单页与详情页是在一个文件里实现的，并且问题与答案杂糅在一起，实际上可以认为这个页面就是答案的表单页与详情页：</p> <p><img src="/assets/docs/kpde9sg0-l96rfonc/detail-and-form-of-question-and-answer-234d780a6daeca6c79b97cbab61d620e27d6928a4532e7b453c502b170498e3e.png" alt="" /></p> <h4 id="section-16">类型定义</h4> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kd">interface</span> <span class="nx">Dimension</span> <span class="p">{}</span>

<span class="kd">interface</span> <span class="nx">CommandParam</span> <span class="p">{}</span>

<span class="kd">interface</span> <span class="nx">Command</span> <span class="p">{</span>
  <span class="nx">code</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">label</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">params</span>: <span class="kt">CommandParam</span><span class="p">[];</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">Answer</span> <span class="p">{</span>
  <span class="nx">content</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">remark</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">dimensions</span>: <span class="kt">Dimension</span><span class="p">[];</span>
  <span class="nx">commands</span>: <span class="kt">Command</span><span class="p">[];</span>
  <span class="nx">approval</span><span class="o">:</span> <span class="s1">&#39;pending&#39;</span> <span class="o">|</span> <span class="s1">&#39;passed&#39;</span> <span class="o">|</span> <span class="s1">&#39;not-passed&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">Question</span> <span class="p">{</span>
  <span class="nx">title</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">category</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">tags</span>: <span class="kt">string</span><span class="p">[];</span>
  <span class="nx">recommendationEnabled</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">searchEnabled</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">matchAllEnabled</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">answers</span>: <span class="kt">Answer</span><span class="p">[];</span>
<span class="p">}</span></code></pre></figure> <h4 id="section-17">文件拆分</h4> <p>将 <code>knowledge</code> 模块 <code>views/knowledge-detail</code> 文件夹内的文件在 <code>question-and-answer</code> 模块下拆分为以下几个视图：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>src/domain
   └── question-and-answer
       └── views
           ├── answer-detail
           │   ├── AnswerDetail.vue
           │   └── index.ts
           ├── answer-form
           │   ├── AnswerForm.vue
           │   └── index.ts
           ├── question-and-answer-data-detail
           │   ├── AnswerListField.vue
           │   ├── QuestionAndAnswerDataDetail.vue
           │   └── index.ts
           └── question-form
               └── index.ts</code></pre></figure> <p>并把答案指令相关的转移到 <code>command</code> 模块：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>src/domain
   └── command
       └── views
           ├── command-data-form
           │   ├── CommandParamListField.vue
           │   └── index.ts
           └── command-data-list
               └── index.ts</code></pre></figure> <h4 id="section-18">数据流</h4> </div> <footer class="Article-footer col-md-3"><section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> </article> </ourai-doc> <script type="text/javascript" src="/assets/pages/doc-c880dc4660dee6b589b91fa90d96d4362f806002998d7fba77f76c8db76c973d.js"></script><script type="text/javascript" src="/assets/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script> </body> </html>
